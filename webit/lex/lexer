%{
#include <stdio.h>
#include <string.h>
%}


/* if REPL:
 [a-z]\n   printf(">"); */

%%
bitches printf("they are in the kitchen\n");
start   printf("Start command received\n");
%%

main()
{
  FILE *infile;
  char fname[40];
  char line[100];
  int lcount;

  char str[100];

  strcpy(fname, "views/index.html");
  /* printf("filename: %s\n", fname); */

  /* Open the file.  If NULL is returned there was an error */
  if((infile = fopen(fname, "r")) == NULL) {
    printf("Error Opening File.\n");
    exit(1);
  }

  printf("Content-type: text/html\n\n");

  while( fgets(line, sizeof(line), infile) != NULL ) {
    /* Get each line from the infile */
    lcount++;
    /* print the line number and data */


    /*
    strcpy(str, "\"");
    strcat(str, line);
    strcat(str, "\"");

    printf("t1");
    lex(str);
    */

    lex(line);
  }

  fclose(infile);  /* Close the file */
}

lex(char *s) {
  FILE *fp;
  char *cmd;
  cmd=malloc(strlen(s)+16);
  sprintf(cmd, "/bin/echo %s", s); // major vulnerability here ...
  fp=popen(cmd, "r");
  dup2(fileno(fp), 0);
  return(yylex());
}

yywrap()
{
  /* exit(0); */
}
